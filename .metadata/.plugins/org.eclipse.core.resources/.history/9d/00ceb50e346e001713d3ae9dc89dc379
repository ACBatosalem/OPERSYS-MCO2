package views;

import java.util.ArrayList;

import javafx.animation.AnimationTimer;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import models.CalTrain;
import models.Passenger;
import models.Station;

public class Train implements Runnable{
	public final static String spriteLoc = "sprites/pellettrain.png";
	private final static int hBounds = 470, wBounds = 460;
	public ImageView sprite;
	public double xValue;
	public double yValue;
	public int trainNum;
	public AnimationTimer timer;
	
	private int num = 10;
	private int num2 = 10;
	private boolean right = false;
	private boolean up = false;
	private boolean left = false;
	private boolean reverse = false;
	private boolean down = false;
	private boolean last = false;
	
	private CalTrain sync;
	private Station boardStation;
	private int freeSeats;
	private final int numSeats;
	private boolean continueRun, direction; /* True = Right. False = Left */
	private ArrayList<Passenger> riders;
	private Thread trainThread = new Thread(this);
	
	public Train(int num, Game g, Station in, CalTrain system, int free){
		trainNum = num;
		
		sprite = new ImageView();
		
		sprite.setImage(new Image(spriteLoc));
		
		xValue = sprite.getLayoutBounds().getMinX();
		yValue = sprite.getLayoutBounds().getMinY();
		
		sprite.setRotate(90);
		
		sprite.setLayoutX(xValue);
		sprite.setLayoutY(yValue);
		
		handleEvents(g);
		animate();
		
		boardStation = in;
		sync = system;
		freeSeats = free;
		numSeats = free;
		this.trainNum = trainNum;
		direction = true;
		continueRun = true;
		riders = new ArrayList<Passenger>();
		trainThread.start();
	}
	
	public Train(Station in, CalTrain system, int free, int trainNum) {
		boardStation = in;
		sync = system;
		freeSeats = free;
		numSeats = free;
		this.trainNum = trainNum;
		direction = true;
		continueRun = true;
		riders = new ArrayList<Passenger>();
		trainThread.start();
	}
	
	public void updateCoordinates(double x, double y){
		xValue = x;
		yValue = y;
	}
	
	public void handleEvents(Game g){
		sprite.setOnMouseClicked(e -> {
			g.p.train(trainNum, 10, 2);
		});
	}
	
	public void animate(){
		timer = new AnimationTimer(){
			@Override
            public void handle(long now) {
            	if(sprite.getLayoutY() + num < hBounds && !right && !up && !reverse){
            		num += 5;
                	sprite.setTranslateY(sprite.getLayoutY() + num);
            	}
            	else if(sprite.getLayoutY() + num >= hBounds && !right && !up && !reverse){
            		right = true;
            		sprite.setRotate(0);
            	}
            	
            	if(sprite.getLayoutX() + num2 < wBounds && right && !up && !left && !reverse && !last){
            		num2 += 5;
            		sprite.setTranslateX(sprite.getLayoutX() + num2);
            	}
            	else if(sprite.getLayoutX() + num2 >= wBounds && !up && !reverse && !last){
            		if(right){
            			right = false;
            			up = true;
                		sprite.setRotate(-90);
            		}
            	}
            	
            	if(sprite.getLayoutY() + num > 10 && up && !right && !reverse){
            		num = num - 5;
            		sprite.setTranslateY(sprite.getLayoutY() + num);
            	}
            	else if(sprite.getLayoutY() + num <= 10 && up && !right && !left && !reverse){
            		right = true;
            		left = true;
            		sprite.setRotate(180);
            	}
            	
            	if(sprite.getLayoutX() + num2 > 75 && left && !reverse && !last){
            		num2 -= 5;
            		sprite.setTranslateX(sprite.getLayoutX() + num2);
            	}
            	else if(sprite.getLayoutX() + num2 <= 75 && left && !reverse && !last){
            		sprite.setTranslateY(30);
            		right = false;
            		left = false;
            		reverse = true;
            		sprite.setRotate(0);
            	}
            	
            	if(sprite.getLayoutX() + num2 < wBounds - 25 && reverse && !left && !last){
            		num2 += 5;
            		sprite.setTranslateX(sprite.getLayoutX() + num2);
            	}
            	else if(sprite.getLayoutX() + num2 >= wBounds - 25 && reverse && !left && !last){
            		down = true;
            		sprite.setRotate(90);
            	}
            	
            	if(sprite.getLayoutY() + num < hBounds - 25 && reverse && down && !left && !last){
            		num += 5;
            		sprite.setTranslateY(sprite.getLayoutY() + num);
            	}
            	else if(sprite.getLayoutY() + num >= wBounds - 25 && reverse && down && !left && !last){
            		sprite.setRotate(180);
            		left = true;
            		down = false;
            	}
            	
            	if(sprite.getLayoutX() + num2 > 20 && reverse && left && !last){
            		num2 -= 5;
            		sprite.setTranslateX(sprite.getLayoutX() + num2);
            	}
            	else if(sprite.getLayoutX() + num2 <= 20 && reverse && left && !last){
            		left = false;
            		sprite.setRotate(-90);
            		last = true;
            	}
            	
            	if(sprite.getLayoutY() + num > 80 && reverse && last){
            		num -= 5;
            		sprite.setTranslateY(sprite.getLayoutY() + num);
            	}
            	else if(sprite.getLayoutY() + num >= 80 && reverse && last){
            		sprite.setRotate(90);
            		last = false;
            		sprite.setTranslateX(0);
            		right = false;
            		up = false;
            		left = false;
            		reverse = false;
            		down = false;
            	}
			}
		};
		
		timer.start();
	}
}
